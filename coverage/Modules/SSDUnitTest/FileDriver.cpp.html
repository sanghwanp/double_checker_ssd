<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>FileDriver.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "FileDriver.h"

<span style = "background-color:#dfd">FileDriver::FileDriver() { Init(); }</span>

<span style = "background-color:#dfd">void FileDriver::Init() {
  if (CheckFileExist(STORAGE_FILE_NAME))
    LoadData();</span>
  else
<span style = "background-color:#fdd">    StoreData();</span>
<span style = "background-color:#dfd">}
bool FileDriver::CheckFileExist(const char* filename) {
  std::ifstream ifs(filename);
  return ifs.is_open();
}</span>

<span style = "background-color:#dfd">void FileDriver::LoadData() {
  std::ifstream ifs(STORAGE_FILE_NAME);</span>

<span style = "background-color:#dfd">  std::string line;
  size_t idx = 0;</span>

<span style = "background-color:#dfd">  while (std::getline(ifs, line) &amp;&amp; idx &lt; MAX_STORAGE_IDX) {
    storageCache[idx] = std::stoul(line, nullptr, 16);
    ++idx;
  }</span>

<span style = "background-color:#dfd">  ifs.close();
}</span>

<span style = "background-color:#dfd">void FileDriver::StoreData() {
  std::ofstream ofs(STORAGE_FILE_NAME);</span>

<span style = "background-color:#dfd">  for (size_t i = 0; i &lt; MAX_STORAGE_IDX; ++i) {
    ofs &lt;&lt; "0x" &lt;&lt; std::hex &lt;&lt; std::uppercase &lt;&lt; std::setw(8)</span>
        &lt;&lt; std::setfill('0') &lt;&lt; storageCache[i] &lt;&lt; "\n";
<span style = "background-color:#dfd">  }</span>

<span style = "background-color:#dfd">  ofs.close();
}</span>

<span style = "background-color:#dfd">void FileDriver::StoreOutput(unsigned int val) {
  std::ofstream ofs(OUTPUT_FILE_NAME);
  ofs &lt;&lt; "0x" &lt;&lt; std::hex &lt;&lt; std::uppercase &lt;&lt; std::setw(8) &lt;&lt; std::setfill('0')</span>
      &lt;&lt; val;
<span style = "background-color:#dfd">  ofs.close();
}</span>

<span style = "background-color:#dfd">void FileDriver::StoreError() {
  std::ofstream ofs(OUTPUT_FILE_NAME);
  ofs &lt;&lt; "ERROR" &lt;&lt; "\n";
  ofs.close();
}</span>

<span style = "background-color:#fdd">const unsigned int* FileDriver::GetBufferAddr(unsigned int lba) {
  return &amp;storageCache[lba];
}</span>

<span style = "background-color:#dfd">const unsigned int FileDriver::GetBufferData(unsigned int lba) {
  return storageCache[lba];
}</span>

<span style = "background-color:#dfd">void FileDriver::SetBufferData(unsigned int lba, unsigned int data) {
  storageCache[lba] = data;
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>